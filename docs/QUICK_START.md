# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Gatling Prometheus Plugin

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ —Å—Ç–∞–ª–æ **–Ω–∞–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ**! –¢–µ–ø–µ—Ä—å –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

## –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ JAR —Ñ–∞–π–ª
```bash
cp target/scala-2.13/gatling-prometheus-plugin_2.13-1.0.0.jar /path/to/your/gatling/project/lib/
```

### 2. –û–±–µ—Ä–Ω–∏—Ç–µ —Ü–µ–ø–æ—á–∫—É –≤ AutoChains
```scala
import ru.x5.svs.gatling.prometheus.AutoChains
import io.gatling.javaapi.core.CoreDsl._
import io.gatling.javaapi.http.HttpDsl._

val scenario = scenario("My Test")
  .exec(
    AutoChains.withAutoMetrics(
      http("API Request")
        .get("/api/endpoint")
        .check(status().is(200))
    )
  )
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
–ú–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Prometheus/VictoriaMetrics!

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

- ‚úÖ **VU –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **HTTP –º–µ—Ç—Ä–∏–∫–∏** - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, —Ä–∞–∑–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞—Ç—É—Å—ã
- ‚úÖ **–ò—Ç–µ—Ä–∞—Ü–∏–∏** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∏** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- ‚úÖ **–ü–∞–º—è—Ç—å** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ JVM
- ‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ VictoriaMetrics

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
export PROMETHEUS_REMOTE_WRITE_URL="http://victoriametrics:8428/api/v1/write"
export PROMETHEUS_PUSH_INTERVAL="10"
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ —Å–ø–æ—Å–æ–±–∞

- **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã
- **–ë–µ–∑ –æ—à–∏–±–æ–∫** - –Ω–µ–ª—å–∑—è –∑–∞–±—ã—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- **–ß–∏—â–µ** - –∫–æ–¥ —Ç–µ—Å—Ç–æ–≤ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–π

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```scala
val manager = PrometheusMetricsManager.getInstance()
manager.start()
// ... —Å—Ç–∞—Ä—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
```

## –ú–∏–≥—Ä–∞—Ü–∏—è

–ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç–µ –≤–∞—à–∏ —Ü–µ–ø–æ—á–∫–∏ –Ω–∞:
```scala
// –ë—ã–ª–æ:
.exec(http("Request").get("/api"))

// –°—Ç–∞–ª–æ:
.exec(AutoChains.withAutoMetrics(http("Request").get("/api")))
```

**–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç:**
```scala
import ru.x5.svs.gatling.prometheus.AutoChains
```

–í–æ—Ç –∏ –≤—Å–µ! üéâ
